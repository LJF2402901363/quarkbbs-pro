<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.quark.common.dao.PostsDao">

    <select id="findAll" resultType="posts">
        select * from quark_posts
    </select>
    <select id="findHot" resultType="posts">
        select p.id, p.title , p.reply_count from quark_posts p where  init_time  between #{startTime}  and #{endTime}  ORDER by reply_count desc limit 10
    </select>
    <select id="findByUser" resultType="posts">
        select * from quark_posts where user_id = #{user.id}
    </select>
    <select id="findByLabel" resultType="posts">
        select * from quark_posts where label_id = #{label.id}
    </select>
    <select id="findByPage" resultType="posts">
   select * from quark_posts
    <where>
      <if test="posts != null">
         <if test="posts.user !=null ">
             user_id = #{posts.user.id}
         </if>
          and #{posts.top} = 1
          and #{posts.good} = 1
          and title like concat('%',#{posts.title},'%')
      </if>

    </where>
    order by asc
    </select>
    <select id="getPostsByPage" resultType="posts">
        select * from quark_posts
        <where>
            <if test="type != null and type !=''">
                <if test="type == 'good'">
                  good = 1
                </if>
                <if test="type == 'top'">
                    top = 1
                </if>
            </if>
            <if test="search != null and search !=''">
                and title like concat('%',#{search},'%')
            </if>
        </where>
    </select>
    <select id="getPostsByUserId" resultType="posts">
        select * from quark_posts where user_id = #{id} order by init_time desc
    </select>
    <select id="getPostsByLabel" resultType="posts">
        select * from quark_posts
        <where>
            <if test="label != null">
                <if test="label.name != null and label.name != ''">
                    name like concat('%',#{label.name},'%')
                </if>
            </if>
        </where>
    </select>
</mapper>